/**
 * @author: Kunal Kanere
 */

(function(){getProgressBarDetails()})();function getProgressBarDetails(){var url="../resources/data.txt";var url2="http://pb-api.herokuapp.com/bars";var jsonData;var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){jsonData=JSON.parse(this.responseText);generateBars(jsonData);generateButtons(jsonData)}};xhttp.open("GET",url2,!0);xhttp.send()}
function generateBars(jsonData){document.getElementById("limit").value=jsonData.limit;var limit=jsonData.limit;for(var i=0;i<jsonData.bars.length;i++){var barVal=jsonData.bars[i];var pct=Math.round((barVal/limit)*100);document.getElementById("bars").innerHTML+='<div id = "bar_'+i+'" class="initialBar progressText"></div>';document.getElementById("bar_"+i).innerHTML+='<div id = "progressBar_'+i+'" class="initialProgressBar" style="width:'+pct+'%"></div>';document.getElementById("bar_"+i).innerHTML+='<var id = "progressValue_'+i+'" class="progressValue">'+pct+"%"+'</var>';var opt=document.createElement('option');opt.appendChild(document.createTextNode('#progress'+(i+1)));opt.value="bar_"+i;opt.id="sel_"+i;var sel=document.getElementById('selectBar');sel.appendChild(opt);var hid=document.createElement("INPUT");hid.setAttribute("type","hidden");hid.id="hid_"+i;hid.value=pct;document.getElementById("bars").appendChild(hid);document.getElementById("bars").innerHTML+='<br><br>'}
document.getElementById("currBar").value="bar_0"}
function generateButtons(jsonData){for(var i=0;i<jsonData.buttons.length;i++){document.getElementById("buttons").innerHTML+='<button class="buttonLayout" id="but_'+i+'" value="'+jsonData.buttons[i]+'" onclick="updateBarVal(this)">'+jsonData.buttons[i]+'</button>';document.getElementById("buttons").innerHTML+='&nbsp;'}}
function updateBarVal(obj){var barId=document.getElementById("currBar").value;var index=barId.split('_')[1];var curPct=Number(document.getElementById("hid_"+index).value);var incrVal=Number(obj.value);var newVal=calculateProgress(curPct,incrVal);var barObj=document.getElementById(barId);var progressBarObj=document.getElementById("progressBar_"+index);var progressValueObj=document.getElementById("progressValue_"+index)
var hid=document.getElementById("hid_"+index);changeBarValue(newVal,progressBarObj,progressValueObj,hid);animateProgress(curPct,newVal,progressBarObj)}
function changeBarValue(newVal,progressBarObj,progressValueObj,hid){if(newVal<0){hid.value=0;progressValueObj.innerText="0%"}
else if(newVal>100){hid.value=newVal;progressValueObj.innerText=newVal+"%";addClass(progressBarObj,"exceededMaxValue","initialProgressBarColour")}
else{hid.value=newVal;progressValueObj.innerText=newVal+"%";addClass(progressBarObj,"initialProgressBarColour","exceededMaxValue")}}
function addClass(ele,newClass,oldClass){if(!ele.classList.contains(newClass)){if(ele.classList.contains(oldClass)){ele.classList.remove(oldClass)}
ele.classList.add(newClass)}}
function animateProgress(curVal,newVal,obj){if(newVal<=0){var width=curVal;var id=setInterval(frame,10);function frame(){if(width<=0){clearInterval(id)}else{width--;obj.style.width=width+'%'}}}else if(newVal<curVal&&newVal>0&&newVal<100){var width=curVal;var id=setInterval(frame,10);function frame(){if(width<=newVal){clearInterval(id)}else{width--;if(width<=100){obj.style.width=width+'%'}}}}
else if(newVal<curVal&&newVal>100){}
else if(newVal>curVal&&newVal<100){var width=curVal+1;var id=setInterval(frame,10);function frame(){if(width>=newVal){clearInterval(id)}else{width++;obj.style.width=width+'%'}}}else{var width=curVal;var id=setInterval(frame,10);function frame(){if(width>=100){clearInterval(id)}else{width++;obj.style.width=width+'%'}}}}
function changeBar(obj){document.getElementById("currBar").value=obj.value}
function calculateProgress(curPct,incrVal){var limit=Number(document.getElementById("limit").value);var newPct=curPct+(Math.round((incrVal/limit)*100));console.log("New pct = "+newPct);return newPct}